<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apply for Job Vacancy - NextGen HR</title>
    <script src="https://kit.fontawesome.com/4cdd077a78.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        .sidebar {
            min-height: 100vh;
            background: #212529;
            color: #fff;
            padding-top: 2rem;
            position: fixed;
            width: 220px;
            left: 0;
            top: 0;
        }

        .sidebar .nav-link {
            color: #adb5bd;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .sidebar .nav-link.active,
        .sidebar .nav-link:hover {
            background: #007bff;
            color: #fff !important;
        }

        .sidebar .nav-link i {
            margin-right: 8px;
        }

        /* MAIN CONTENT SHIFT */
        .main-content {
            margin-left: 220px;
            padding: 2rem;
        }

        .footer {
            background: #343a40;
            color: #fff;
            padding: 30px 0 10px 0;
        }

        .navbar-brand span {
            color: #007bff;
        }

        label {
            cursor: pointer;
        }
    </style>
</head>

<body>


    <!-- Navigation -->

    <!-- SIDEBAR -->
    <div class="sidebar d-none d-md-block">
        <div class="text-center mb-4">
            <h4>NextGen<span class="text-primary">HR</span> </h4>
        </div>

        <nav class="nav flex-column">
            <a class="nav-link" href="./dashboard.html"><i class="bi bi-speedometer2"></i> <span>Dashboard</span></a>
            <a class="nav-link " href="./Register.html"><i class="bi bi-people"></i> <span>Register</span></a>
            <a class="nav-link " href="./approvals.html"><i class="bi bi-check2-square"></i> <span>Approvals</span></a>
            <a class="nav-link" href="./reminders.html"><i class="bi bi-bell"></i> <span>Reminders</span></a>
            <a class="nav-link" href="./users.html"><i class="bi bi-people"></i> <span>Users</span></a>
            <a class="nav-link" href="./departments.html"><i class="bi bi-diagram-3"></i> <span>Departments</span></a>
            <a class="nav-link" href="./leave_request.html"><i class="bi bi-calendar-check"></i>
                <span>LeaveRequests</span></a>
            <a class="nav-link" href="./payroll.html"><i class="bi bi-cash-stack"></i> <span>Payroll</span></a>

            <a class="nav-link active" href="./viewJobpostData.html"><i class="bi bi-briefcase"></i> <span>Job Posts</span></a>
            <a class="nav-link " href="./Attendance.html"><i class="bi bi-person-check"></i> <span>Attendance</span></a>

        </nav>
    </div>
    <section>
        <div class="main-content">
            <div class="container py-4 flex-grow-1">
                <div class="topbar rounded-4 mb-4 d-flex justify-content-between align-items-center shadow-sm p-3">
                    <h5>Job Applications</h5>
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> Admin
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="login.html">Logout</a></li>
                        </ul>
                    </div>
                </div>
                <div>
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Position</th>
                                <th>Resume</th>
                                <th colspan="2" class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="jobpostdata"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer text-center">
        <div class="container">
            <p class="mb-1">&copy; 2025 NextGen HR. All rights reserved.</p>
            <small>Empowering people, powering business.</small>
        </div>
    </footer>

    <div class="modal fade" id="showApplicationModal" tabindex="-1" aria-labelledby="showApplicationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="showApplicationModalLabel">Edit Application Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editApplicationForm">
                    <div class="modal-body">
                        <input type="hidden" id="editId" name="id">
                        <div class="mb-3">
                            <label class="form-label fw-bold" for="editName">Full Name:</label>
                            <input type="text" class="form-control" id="editName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold" for="editEmail">Email address:</label>
                            <input type="email" class="form-control" id="editEmail" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold" for="editPosition">Position Applied For:</label>
                            <input type="text" class="form-control" id="editPosition" name="position" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold" for="editResume">Resume:</label>
                            <textarea class="form-control" id="editResume" name="resume" rows="4" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="edit">Close</button>
                        <button type="submit" class="btn btn-primary">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>

        addEventListener("DOMContentLoaded", async () => {
            try {
                //Fetch Data from jobvecencylist API and show in table
                let fetch_data = await fetch("http://localhost:3000/jobvecancylist")
                let response = await fetch_data.json();
                // console.log(response,"response");

                let tablebody = document.getElementById("jobpostdata");

                response.forEach((e, index) => {
                    tablebody.innerHTML +=
                        `<tr> 
                        <td>${index + 1}</td>
                        <td>${e.name}</td>
                        <td>${e.email}</td>
                        <td>${e.position}</td>
                        <td>${e.resume}</td>
                        <td><button class="text-center btn btn-primary btn-sm showApplicationBtn" data-bs-toggle="modal" data-bs-target="#showApplicationModal" id="edit" data-id="${e._id}">Edit</button></td>
                        <td><button class="text-center btn btn-danger btn-sm delateApplicationBtn" id="delete" data-id="${e._id}">Delete</button></td>
                    </tr>`
                });

                // Show Application Details in Modal
                const modeleditbtn = document.querySelectorAll('.showApplicationBtn'); //return all edit btn then use queryselectorall
                //  console.log(modeleditbtn);

                modeleditbtn.forEach(btn => {
                    btn.addEventListener("click", async (e) => {
                        e.preventDefault();
                        const btnattribute = btn.getAttribute("data-id");
                        // console.log(btnattribute);
                        idobj = { id: btnattribute };
                        //Fetch Single Data from jobvecancysingledata API
                        const singlefetch = await fetch("http://localhost:3000/jobvecancysingledata", {
                            method: "POST",
                            headers: {
                                "content-type": "application/json",
                            },
                            body: JSON.stringify(idobj)
                        });


                        const singleresponse = await singlefetch.json();
                        // console.log(singleresponse,"singleresponse");

                        document.getElementById("editId").value = singleresponse._id;
                        document.getElementById("editName").value = singleresponse.name;
                        document.getElementById("editEmail").value = singleresponse.email;
                        document.getElementById("editPosition").value = singleresponse.position;
                        document.getElementById("editResume").value = singleresponse.resume;
                    });
                });
                // Update Application Details in Modal
                const updateform = document.getElementById("editApplicationForm")
                updateform.addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const id = document.getElementById("editId").value;
                    const updateddata = {
                        name: document.getElementById("editName").value,
                        email: document.getElementById("editEmail").value,
                        position: document.getElementById("editPosition").value,
                        resume: document.getElementById("editResume").value,
                    }
                    const update_fetch = await fetch("http://localhost:3000/updatejobapplicationdata",
                        {
                            method: "PUT",
                            headers: {
                                "content-type": "application/json",
                            },
                            body: JSON.stringify({ id, ...updateddata })
                        }
                    )
                    //  console.log(update_fetch);

                    const update_response = await update_fetch.json();
                    // console.log(update_response);

                    if (update_fetch.ok) {
                        alert("Application updated successfully!");
                        location.reload();
                    }
                    else {
                        alert(`failed to update application: ${update_response.message}`);
                    }
                })


                //Delate Application from viewJobpostData table
                const deletebtn = document.querySelectorAll('.delateApplicationBtn'); //return all delete btn 
                // console.log(deletebtn);

                deletebtn.forEach(btn => {
                    // console.log(btn);
                    btn.addEventListener("click", async (e) => {
                        e.preventDefault();
                        const btnattri = btn.getAttribute("data-id");
                        console.log(btnattri);
                        const deleteobj = { id: btnattri };

                        const delate_fetch = await fetch("http://localhost:3000/deletejobapplicationdata", {
                            method: "DELETE",
                            headers: {
                                "content-type": "application/json",
                            },
                            body: JSON.stringify(deleteobj)
                        });
                        // console.log(delate_fetch,"delate fetch");
                        const delate_response = await delate_fetch.json();
                        // console.log(delate_response,"delate response");

                        if (delate_fetch.ok) {
                            alert(`Application deleted successfully! ${delate_response.message}`);
                            location.reload();

                        }
                        else {
                            alert(`failed to delete application: ${delate_response.message}`);
                        }
                    })
                });


            }
            catch (error) {
                console.error(error);
            }

        });
    </script>

</body>

</html>